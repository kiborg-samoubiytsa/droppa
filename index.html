<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi File Upload</title>
    <style>
      body {
          font-family: Arial, sans-serif;
          background-color: #f4f4f9;
          color: #333;
          margin: 0;
          padding: 20px;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          min-height: 100vh;
      }
      h1 {
          margin-bottom: 20px;
          color: #4CAF50;
      }
      form {
          background: #fff;
          padding: 20px;
          border-radius: 10px;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
          text-align: center;
          width: 100%;
          max-width: 400px;
      }
      input[type="file"] {
          display: block;
          margin: 10px auto;
      }
      button {
          padding: 10px 20px;
          background: #4CAF50;
          color: white;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          font-size: 16px;
          transition: background 0.3s;
      }
      button:hover {
          background: #45a049;
      }
      #status {
          margin-top: 20px;
          font-size: 14px;
      }
      .status-message {
          margin-bottom: 5px;
      }
      .success {
          color: green;
      }
      .error {
          color: red;
      }
    </style>
  </head>
  <body>
    <h1>Multi File Upload</h1>
    <form id="upload-form">
      <input type="file" id="file-input" name="files" multiple required>
      <button type="button" id="upload-button">Upload</button>
    </form>
    <div id="status"></div>

    <script>
      document.getElementById('upload-button').addEventListener('click', async () => {
          const fileInput = document.getElementById('file-input');
          const statusDiv = document.getElementById('status');
          statusDiv.innerHTML = ''; // Clear previous status messages

          if (!fileInput.files.length) {
              const message = document.createElement('div');
              message.textContent = "Please select files!";
              message.classList.add('status-message', 'error');
              statusDiv.appendChild(message);
              return;
          }

          const files = Array.from(fileInput.files);

          // Start parallel uploads
          const uploadPromises = files.map((file) => uploadFile(file, statusDiv));

          // Wait for all uploads to complete
          await Promise.all(uploadPromises);
      });

      async function uploadFile(file, statusDiv) {
          const formData = new FormData();
          formData.append('file', file);

          const message = document.createElement('div');
          message.textContent = `Uploading ${file.name}...`;
          message.classList.add('status-message');
          statusDiv.appendChild(message);

          try {
              const response = await fetch('/upload', {
                  method: 'POST',
                  body: formData,
              });

              if (response.ok) {
                  message.textContent = `${file.name} uploaded successfully!`;
                  message.classList.add('success');
              } else {
                  const errorText = await response.text();
                  message.textContent = `${file.name} failed: ${errorText}`;
                  message.classList.add('error');
              }
          } catch (error) {
              message.textContent = `${file.name} error: ${error.message}`;
              message.classList.add('error');
          }
      }
    </script>
  </body>
</html>
